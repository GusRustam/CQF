%% cleanup
clear('all');
close('all');

%% init
terms = [0.083333	0.166667	0.250000	0.333333	0.416667	0.500000	0.583333	0.666667	0.750000	0.833333	0.916667	1.000000	1.083333	1.166667	1.250000	1.333333	1.416667	1.500000	1.583333	1.666667	1.750000	1.833333	1.916667	2.000000	2.083333	2.166667	2.250000	2.333333	2.416667	2.500000	2.583333	2.666667	2.750000	2.833333	2.916667	3.000000	3.083333	3.166667	3.250000	3.333333	3.416667	3.500000	3.583333	3.666667	3.750000	3.833333	3.916667	4.000000	4.083333	4.166667	4.250000	4.333333	4.416666	4.500000	4.583333	4.666666	4.750000	4.833333	4.916666	5.000000	5.500000	6.000000	6.500000	7.000000	7.500000	8.000000	8.500000	9.000000	9.500000	10.000000	10.500000	11.000000	11.500000	12.000000	12.500000	13.000000	13.500000	14.000000	14.500000	15.000000	15.500000	16.000000	16.500000	17.000000	17.500000	18.000000	18.500000	19.000000	19.500000	20.000000	20.500000	21.000000	21.500000	22.000000	22.500000	23.000000	23.500000	24.000000	24.500000	25.000000];
spot_rates = [4.621400	4.508064	4.490767	4.524603	4.530169	4.508599	4.465583	4.412137	4.360421	4.320045	4.291137	4.271533	4.258928	4.252184	4.250493	4.253044	4.259029	4.267638	4.278062	4.289491	4.301165	4.312745	4.324113	4.335157	4.345794	4.355954	4.365571	4.374640	4.383186	4.391233	4.398805	4.405931	4.412640	4.418961	4.424922	4.430553	4.435875	4.440909	4.445673	4.450187	4.454468	4.458534	4.462403	4.466091	4.469617	4.472998	4.476249	4.479379	4.482402	4.485329	4.488170	4.490933	4.493622	4.496241	4.498792	4.501279	4.503706	4.506076	4.508392	4.510658	4.523203	4.533821	4.542177	4.547936	4.551054	4.552000	4.551169	4.548798	4.544845	4.538891	4.530513	4.519295	4.504765	4.487030	4.466367	4.443077	4.417594	4.390391	4.361944	4.332727	4.303215	4.273881	4.245201	4.217572	4.191131	4.165956	4.142127	4.119723	4.098822	4.079504	4.061847	4.045857	4.031423	4.018420	4.006724	3.996211	3.986757	3.978238	3.970541	3.963599];

%% calculation
forward_rates = [spot_rates(1) spot_rates(2:end) + diff(spot_rates)./diff(terms).*terms(2:end)];
new_spot_rates = [forward_rates(1) (cumsum(forward_rates(2:end).*diff(terms))+forward_rates(1)*terms(1))./terms(2:end)];

%% error as a percentage
sum(new_spot_rates - spot_rates) / sum(spot_rates) * 100  %#ok

%% plot
plot(forward_rates,'DisplayName','forward_rates','YDataSource','forward_rates');
hold all;
plot(new_spot_rates,'DisplayName','new_spot_rates','YDataSource','new_spot_rates');
plot(spot_rates,'DisplayName','spot_rates','YDataSource','spot_rates');
hold off;
figure(gcf);